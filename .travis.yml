language: python
python:
  - "2.7"
install:
  - "sudo apt-get install pigz"
  - "pip install coveralls virtualenv"
  - "pip install decorator"
  - "./metrique.py deploy --all"
  - "./metrique.py firstboot metrique postgresql mongodb"
services: 
  - mongodb
addons:
    postgresql: "9.3"
script: 
  - "coverage run --source=metrique -m py.test tests -m 'not perf'"
#before_script:
#  - psql -c 'CREATE USER admin;' -U postgres
#  - psql -c 'create database admin WITH OWNER admin;' -U postgres
after_success:
  - coveralls
after_failure:
  - "cat ~/.metrique/*"
